<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/BarChart.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/BarChart.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import "../main.scss";

import SvgHelper from "../helpers/SvgHelper";
import TimeHelper from "../helpers/TimeHelper";
import PropTypes from "prop-types";
import { Component } from "react";
import * as d3 from "d3";

/**
 * Component for showing the user's activity with a bar chart.
 * @component
 * @extends Component
 */
class BarChart extends Component {
  /**
   * Creates a bar chart.
   * @param   {Number}    width        The width of the chart.
   * @param   {Number}    height       The height of the chart.
   * @param   {String}    firstColor   The color used in the chart for the first set of data.
   * @param   {String}    secondColor  The color used in the chart for the second set of data.
   * @param   {Object[]}  dataset      The data used to draw the chart.
   */
  constructor(props) {
    super(props);
    this.width = 835;
    this.height = 320;
    this.firstColor = "#282d30";
    this.secondColor = "#e60000";
    this.dataset = props.data;
  }
  componentDidMount() {
    /**
     * Deletes the chart if it already exists.
     * */
    d3.select("#barchart svg").remove();
    d3.selectAll(".barchart-tooltip").remove();

    /**
     * Creates the SVG container.
     */
    const svg = SvgHelper.createSvg(
      "#barchart",
      this.width,
      this.height,
      "#fbfbfb"
    );

    /**
     * Creates the title of the chart.
     */
    SvgHelper.drawText(
      svg,
      32,
      29,
      "Activité quotidienne",
      ".barchart-title",
      "#20253a"
    );

    /**
     * Creates the keys of the chart.
     */
    const keys = svg.append("g").attr("class", "barchart-key");
    SvgHelper.drawCircle(keys, 540, 38, 4, this.firstColor);
    SvgHelper.drawText(
      keys,
      555,
      43,
      "Poids (kg)",
      "barchart-key-title",
      "#74798c"
    );
    SvgHelper.drawCircle(keys, 654, 38, 4, this.secondColor);
    SvgHelper.drawText(
      keys,
      670,
      43,
      "Calories brûlées (kCal)",
      "barchart-key-title",
      "#74798c"
    );

    /**
     * Creates the x-axis.
     */
    const xAxisGroup = svg.append("g").attr("transform", "translate(0,257)");
    const xMin = d3.min(this.dataset, (d) => d.day);
    const xMax = d3.max(this.dataset, (d) => d.day);
    const xEnd = TimeHelper.addOneDay(xMax);
    const xScale = d3.scaleUtc().domain([xMin, xEnd]).rangeRound([43, 745]);
    const xAxis = d3.axisBottom(xScale).ticks(0);
    xAxisGroup.call(xAxis).attr("class", "barchart-ticks");
    svg
      .selectAll(".barchart-ticks-text")
      .data(this.dataset)
      .enter()
      .append("text")
      .attr("class", "barchart-ticks")
      .attr("x", (d, i) => 75 + 100 * i)
      .attr("y", "295")
      .attr("fill", "#9b9eac")
      .text((d) => TimeHelper.formatDate(d.day));

    /**
     * Creates the kilogram y-axis on the left.
     */
    const yLeftAxisGroup = svg
      .append("g")
      .attr("transform", "translate(43,112)");
    const minKilogram = d3.min(this.dataset, (d) => d.kilogram);
    const maxKilogram = d3.max(this.dataset, (d) => d.kilogram);
    const yLeftScale = d3
      .scaleLinear()
      .domain([maxKilogram, minKilogram - 3])
      .range([0, 145]);
    const yLeftAxis = d3.axisLeft(yLeftScale);
    yLeftAxisGroup.call(yLeftAxis).attr("class", "barchart-ticks");
    SvgHelper.drawText(
      yLeftAxisGroup,
      10,
      -10,
      "kg",
      "barchart-ticks",
      "#9b9eac"
    );

    /**
     * Creates the calories y-axis on the right.
     */
    const yRightAxisGroup = svg
      .append("g")
      .attr("transform", "translate(745,112)");
    const maxCalories = d3.max(this.dataset, (d) => d.calories);
    const yRightScale = d3
      .scaleLinear()
      .domain([maxCalories, 0])
      .range([0, 145]);
    const yRightAxis = d3.axisRight(yRightScale);
    yRightAxisGroup.call(yRightAxis).attr("class", "barchart-ticks");
    SvgHelper.drawText(
      yRightAxisGroup,
      -10,
      -10,
      "kCal",
      "barchart-ticks",
      "#9b9eac"
    );

    /**
     * Creates horizontal graduations.
     */
    yLeftAxisGroup
      .selectAll("y axis")
      .data(yLeftScale.ticks(8))
      .enter()
      .append("line")
      .attr("stroke", "#dedede")
      .attr("stroke-dasharray", "4,2")
      .attr("x1", 0)
      .attr("x2", 702)
      .attr("y1", (d) => yLeftScale(d))
      .attr("y2", (d) => yLeftScale(d));

    /**
     * Creates the tooltip.
     */
    const tooltip = svg
      .append("g")
      .attr("class", "barchart-tooltip")
      .style("display", "none");

    const overlay = SvgHelper.drawRectangle(
      tooltip,
      68,
      112,
      56,
      145,
      "#c4c4c4"
    );
    overlay.style("opacity", "50%");

    SvgHelper.drawRectangle(tooltip, 131, 82, 39, 63, "#e60000");
    const tooltipKilograms = SvgHelper.drawText(
      tooltip,
      142,
      101,
      "",
      "barchart-tooltip-box",
      "#fff"
    );
    const tooltipCalories = SvgHelper.drawText(
      tooltip,
      137,
      132,
      "",
      "barchart-tooltip-box",
      "#fff"
    );

    /**
     * Creates the kilograms bars of the chart.
     */
    svg
      .selectAll(".barchart-bar-kilograms")
      .data(this.dataset)
      .enter()
      .append("rect")
      .attr("x", (d) => xScale(TimeHelper.addHours(d.day, 12)) - 10)
      .attr("y", (d) => 112 + yLeftScale(d.kilogram))
      .attr("fill", this.firstColor)
      .attr("width", 6)
      .attr("height", (d) => 145 - yLeftScale(d.kilogram))
      .attr("class", "barchart-bar-kilograms");

    /**
     * Creates the calories bars of the chart.
     */
    svg
      .selectAll(".barchart-bar-calories")
      .data(this.dataset)
      .enter()
      .append("rect")
      .attr("x", (d) => xScale(TimeHelper.addHours(d.day, 12)) + 4)
      .attr("y", (d) => 112 + yRightScale(d.calories))
      .attr("fill", this.secondColor)
      .attr("width", 6)
      .attr("height", (d) => 145 - yRightScale(d.calories))
      .attr("class", "barchart-bar-calories");

    /**
     * Creates the tooltip event on hover.
     */
    svg
      .append("rect")
      .attr("x", "43")
      .attr("y", "112")
      .attr("width", 702)
      .attr("height", this.height)
      .style("opacity", "0.01%")
      .on("mouseover", function (event) {
        tooltip.style("display", null);
      })
      .on("mouseout", function (event) {
        tooltip.style("display", "none");
      })
      .on("mousemove", (e) => {
        const x0 = xScale.invert(d3.pointer(e)[0]);
        let index = TimeHelper.bisectDate(this.dataset, x0);
        if (x0.getDate() &lt; 7 &amp;&amp; x0.getHours() > 13 &amp;&amp; index > 0) {
          index -= 1;
        }
        const d = this.dataset[index];
        tooltip.attr("transform", "translate(" + 100 * index + ",0)");
        tooltipKilograms.html(d.kilogram + "kg");
        tooltipCalories.html(d.calories + "kCal");
      });
  }
  render() {
    return &lt;>&lt;/>;
  }
}

BarChart.propTypes = {
  data: PropTypes.array.isRequired,
};

export default BarChart;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Activity.html">Activity</a></li><li><a href="ActivityData.html">ActivityData</a></li><li><a href="ApiService.html">ApiService</a></li><li><a href="BarChart.html">BarChart</a></li><li><a href="LineChart.html">LineChart</a></li><li><a href="Navbar.html">Navbar</a></li><li><a href="NutritionalValue.html">NutritionalValue</a></li><li><a href="Performance.html">Performance</a></li><li><a href="PerformanceData.html">PerformanceData</a></li><li><a href="RadarChart.html">RadarChart</a></li><li><a href="RadialBarChart.html">RadialBarChart</a></li><li><a href="Session.html">Session</a></li><li><a href="SessionData.html">SessionData</a></li><li><a href="SvgHelper.html">SvgHelper</a></li><li><a href="TimeHelper.html">TimeHelper</a></li><li><a href="User.html">User</a></li><li><a href="VerticalNavbar.html">VerticalNavbar</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Wed Mar 29 2023 16:24:43 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
